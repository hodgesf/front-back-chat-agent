from langchain_core.output_parsers import StrOutputParser
from langchain_core.prompts import PromptTemplate
from langchain_openai import ChatOpenAI

def check_hallucination(query, generated_responses, reranked_documents):
    # Perform your hallucination checking logic here
   

    prompt = PromptTemplate(
        template="""System:You are an assistant for evaluating the accuracy of responses generated by a chatbot about two rare diseases, Hypophosphatasia and Ehler-Danlos Syndrome. 
        You have access to a database of medical documents related to the question they ask for context and only have the ability to assess responses based on the context provided.
        Use the following pieces of retrieved context to evaluate the chatbot's response. 
        If the response is consistent with the provided context, output 'yes'. If the response is not supported by the context, output 'no'.
        User:
        Question: {question} 
        Context: {context} 
        Chatbot Response: {response}""",
        input_variables=["question", "context", "response"],
)
    llm = ChatOpenAI(model="gpt-3.5-turbo", temperature=0.2)

    hallucination_grader_chain = prompt | llm | StrOutputParser()
    try: 
        is_hallucinating = hallucination_grader_chain.invoke({"question": query, "context": reranked_documents, "response": generated_responses})
    except Exception as e:
        is_hallucinating = "no"

    return True if is_hallucinating == "yes" else False

